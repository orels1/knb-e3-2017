# Kanobu E3 2017
>All aboard the hype train!

## Развертывание

### Что нужно на машине

- Node 7.10
- MongoDB

### Как запускать

>**Перед началом:** на всякий случай лучше вручную создать файл data/knb_cred.json с таким содержимым:
```
{
    "access_token": "test",
    "refresh_token": test
}
```

Затем нужно указать env вары: `CLIENT_ID`, `CLIENT_SECRET`, `KNB_LOGIN`, `KNB_PASS` (например в конфе supervisord)

Наконец

```
npm install

node server.js
```

И на этом все. По дефолту прога запустится на 3000 порту. Можно замаппить на другой порт с env варой `E3_PORT`

Кастомный путь к монге можно положить в env вару `MONGO_URL`

### Как менять

```
npm install --only=dev

npm run watch
```

Затем можно идти менять сервер / клиент - все будет перегенерится на лету.

### Изменение рубрики

Чтобы быстро изменить рубрику - нужно поменять значение env вары `E3_RUBRIC` на нужный слаг, например `e3_2018`. После чего необходимо очистить коллекции `articleitems`, `newsitems` и `bingos` в mongodb на node02.kanobu.ru, монга живет там на `27020` порту. Затем раздел начнет обновлять статьи и новости в автоматическом режиме.

Список стримов задается в `server.js` в простом JS-объекте.

### Билд в прод

```
npm run build:prod
```

Минифицирует все жски и возьмет прод-билд реакта

### Остановка

Чтобы погасить сервис - нужно удалить его конфигурацию из `/etc/supervisord.conf` и рестартануть супервизорд (т.к.  `supervisorctl` на node02 почему-то не работает)
